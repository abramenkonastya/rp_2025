
# Реализация типовых операций для преодоления вертикального препятствия колесно-шагающим роботом
## Цель проекта:

Увеличить проходимость робота, оснащенного колесно-шагающим шасси, посредством внедрения в его систему управления типовых операций, необходимых для преодоления вертикального препятствия.
## Задачи проекта:
1. Определить способ преодоления вертикального препятствия колесно-шагающим роботом.
2. Выделить и реализовать необходимые типовые операции, сформировать их последовательность.
3. Протестировать разработанное решение и проверить его эффективность на вертикальной ступени

## Инструкция по запуску:
1. Создать файл Controls_Plant_2.mat в Adams View (открыть файл Shassis_Putnik.bin) для обмена входными и выходными данными между Adams и Simulink: Controls → Plant Export. Явно указать входные и выходные параметры системы. Для удобства соответствующий файл уже создан.
2. Открыть папку с соответствующим проектом в Matlab и запустить файл Controls_Plant_2.mat.
3. Запустить preparationScript_step_up_idela.mlx для инициализации.
4. Запустить модель TestModelWLRover_Script.slx для запуска симуляции.

## Реализованные функции

### 1. Подготовительный этап (вне проекта) - исходная система управления, которая использована в проекте для дальнейшей разработки и внедрения типовых операций.

Ранее мной и моими коллегами была разработана система управления роботом, построенная по принципу Master-Controller-Model:
- Master (Планировщик высокого уровня): управляет последовательностью выполнения типовых операций.
- Controller (Регулятор): Вычисляет управляющие моменты для шарниров робота на основе текущей типовой операции.
- Model (Модель робота): Предоставляет математическое представление робота (кинематика, динамика, состояние) для выполнения расчетов.

Блок Master включает в себя:
- менеджер задач **roverManager** - получает текущую задачу (типовую операцию), проверяет условие ее завершения и переключает на следующую задачу. Производит первый запуск скрипта.
- менеджер скриптов **ScriptManager** – содержит список задач (типовых операций) и создает объекты конкретных задач. Позволяет добавлять задачи в taskList, определяет сценарий поведения робота.
- **Task** классы – конкретные типовые операции. Созданы в процессе выполнения данного проекта и описаны ниже в разделе 2.

Блок Controller включает в себя **roverControllerScript**, осуществляющий управление жизненным циклом задачи: передает текущее состояние робота в задачу, возвращает управляющие моменты (рассчитанные посредством метода **currentTask****.****FindControl** с помощью решения задачи обратной динамики внутри выполнения текущей типовой операции), ожидает достижения целевого состояния.

Блок Model включает в себя:
- «Цифровой двойник» робота **WLRobot** – содержит информацию о геометрических параметрах и массо-инерционных характеристиках, умеет рассчитывать якобианы (FindRoverMatrices), решать обратную кинематику (ikSolver), находить точки контакта (FindContactPoints), вычислять плоскость опоры (FindPlane) и рассчитывать требуемые скорости колес (FindWheelDesiredSpeed)
- Функция **stateWatcher** – согласовывает физическую модель в Adams и математическую модель в Matlab, преобразуя данные о состоянии робота, получаемые из Adams.
- Контейнер данных **State** – хранит координаты и скорости робота, а также силы в точках опоры. Получает итоговое состояние из stateWatcher.

### 2. Разработка типовых операций
Типовые операции предполагается выполнять в той последовательности, в которой они приведены в файле **preparationScript_step_up_idela.mlx**. Данная программа создает глобальные переменные, загружает и инициализирует модель робота, создает объект ScriptManager для управления задачами.

#### Список реализованных типовых операций и их функции:
###### **1. JointTask**
Осуществляет управление отдельными сочленениями ног робота (бедро, колено, рулевой, колесо) для достижения заданных углов или скоростей. Предусмотрено 3 режима управления суставами: 'P' - управление положением (пропорциональный регулятор), 'V' - управление скоростью (регулятор по скорости), '0' - сустав фиксируется в начальном положении.

В конструкторе JointTask учитываются активные ноги, для которых выполняется управление, режим управления, целевые значения и минимальное время выполнения операции. В основном методе FindControl с учетом выбранного режима управления происходит расчет управляющих моментов через обратную динамику. Для управления используется ПД-регулятор.

Метод **Complited****()** производит проверку завершения выполнения задачи: достижение целевых углов с допуском tolerance = 0.15 рад, достижение целевой скорости корпуса и превышение minTime.

Данная операция используется для управления положением конкретных суставов при поднятии задних ног на ступень.

###### **2. CartesianTask** 
Осуществляет управление положением конца ноги (стопы/колеса) в декартовых координатах относительно корпуса робота. Использует обратный якобиан — математическую матрицу, которая пересчитывает требуемую скорость движения конца ноги в пространстве в необходимые скорости вращения каждого сустава.

В конструкторе CartesianTask учитываются активные ноги и целевые горизонтальное и вертикальное смещения. В основном методе FindControl()  создаются плавные траектории для активных ног, производится слежение по траектории с компенсацией ошибки и силовой контроль для поддержания контакта ног с поверхностью.

Метод Complited() производит проверку завершения выполнения задачи, а именно достижение целевой позиции конца ноги с допусками и превышение minTime.

Данная операция используется для поднятия передних ног на ступень.

###### **3. CrabTask**
Это комплексная задача для поступательного движения робота, создаёт последовательность из двух подзадач:
- **SteerTask** - устанавливает угол поворота всех колёс в заданное положение. Использует JointTask для управления только рулевыми (3-ми) суставами всех ног, при этом остальные суставы фиксируются. Метод Complited() производит проверку завершения выполнения задачи, а именно достижение целевого угла поворота всех рулевых суставов с допусками и превышение minTime.
- **CrabLineTask** – выполняет движение робота по прямой линии с заданной скоростью и углом. Данный метод создаёт траекторию через **CreateTrajectoryLine** - прямую линию длиной L под углом alpha. Аналогично, метод FindControl управляет скоростью и углами поворота колес для движения по заданной траектории, а также использует обратную динамику для поиска управляющих моментов.

Данная операция используется для продольного перемещения робота после закидывания передних ног на препятствие для дальнейшего закидывания задних ног. В связи с этим, условие для завершения подзадачи Completed() проверяет положение центра масс робота относительно края ступени.

## Результаты

Успешное преодоление препятствий высотой 0,4 и 0,8 препятствия.

Начальное положение робота:

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image002.jpg) ![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image004.jpg)

Подъем первой конечности (CartesianTask):

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image006.jpg) ![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image008.jpg)

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image010.jpg)

Подъем второй конечности (CartesianTask):

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image012.jpg) ![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image014.jpg)

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image016.jpg) 

Поступательное движение(CrabTask):

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image018.jpg) ![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image020.jpg)

Перенос третьей конечности (JointTask):

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image022.jpg) ![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image024.jpg)

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image026.jpg)

Перенос четвертой конечности (JointTask):

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image028.jpg) ![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image030.jpg)

Поступательное движение(CrabTask):

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image032.jpg)

Итоговое положение робота:

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image034.jpg)

![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image036.jpg) ![](file:///C:/Users/kares/AppData/Local/Packages/oice_16_974fa576_32c1d314_3fbf/AC/Temp/msohtmlclip1/01/clip_image038.jpg)